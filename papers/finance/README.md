# Weighted Kolmogorov Metric for Heavy-Tailed Risk Models

**Restoring $O(n^{-1/2})$ convergence for financial backtesting in high-frequency and crypto regimes.**

![Python](https://img.shields.io/badge/python-3.8%2B-blue)
![License](https://img.shields.io/badge/license-MIT-green)
![Status](https://img.shields.io/badge/status-research-orange)

## üìñ Overview

Standard risk metrics used in model validation, such as the Kolmogorov‚ÄìSmirnov (KS) distance, fail to converge at practical rates when applied to heavy-tailed data (infinite skewness). This creates a **"noise barrier"** where valid risk models are rejected due to tail events that are irrelevant to the accuracy of the central tendency.

This repository implements the **Weighted Kolmogorov Metric ($d_{K,h,q}$)** and the **Hybrid Validation Protocol** described in the research paper:

> **Restoring Convergence in Heavy-Tailed Risk Models: A Weighted Kolmogorov Approach for Robust Backtesting**  
> *Armen Petrosyan (2025)*

### Key Benefits

- **Restores Convergence:** Recovers the optimal Gaussian rate $O(n^{-1/2})$ for Pareto and Student-t distributions.
- **Hybrid Validation:** Decouples statistical stability (via the weighted metric) from tail compliance (via VaR/ES checks).
- **Anti-Gaming Protocol:** Includes a "Grid Robustness" check to prevent parameter overfitting.

---

## üöÄ Quick Start

### Installation

Clone the repository and install the dependencies:

```bash
git clone https://github.com/Armen0807/Mathematical-Research-Notes.git
cd Mathematical-Research-Notes
pip install -r requirements.txt
```

### Usage Example

You can compute the weighted metric for any empirical dataset against a theoretical benchmark:

```python
from exhaustion_framework.metric import weighted_kolmogorov_metric
from scipy import stats
import numpy as np

# 1. Load your heavy-tailed returns
data = np.loadtxt("experiments/outputs/data/returns.csv")

# 2. Define your candidate model (e.g., Student-t)
model = stats.t(df=3, loc=0, scale=0.01)

# 3. Compute the Weighted Metric (q=1.2)
score = weighted_kolmogorov_metric(data, model, q=1.2)
print(f"Weighted Error: {score:.5f}")
```

---

## üõ°Ô∏è Grid Robustness (Anti-Gaming)

To ensure the weighting parameter $q$ is not "tuned to pass," we enforce a Grid Robustness Protocol. The model must pass the validation threshold for the worst-case error across a pre-defined grid of $q$ values.

Run the certification script:

```bash
python scripts/run_grid_robustness.py
```

### Evidence of Stability

The figure below (generated by the script) serves as a Stability Certificate.

- **Green Line:** The correct model (Student-t) remains stable and valid across all $q$.
- **Red Line:** A misspecified model (Gaussian) is rightfully rejected because its worst-case error exceeds the threshold, even if it appears valid for high $q$.

---

## üìù Citation

If you use this code or framework in your research or production models, please cite the paper:

```bibtex
@article{petrosyan2025weighted,
  title={Restoring Convergence in Heavy-Tailed Risk Models: A Weighted Kolmogorov Approach for Robust Backtesting},
  author={Petrosyan, Armen},
  year={2025},
  note={Available at GitHub: https://github.com/Armen0807/Mathematical-Research-Notes}
}
```
